<!DOCTYPE html>
<meta charset="utf-8" />

<head>
    <title>Variable Radius Donut Chart</title>
    <link data-require="normalize@*" data-semver="3.0.1" rel="stylesheet"
        href="//cdnjs.cloudflare.com/ajax/libs/normalize/3.0.1/normalize.min.css" />

    <script src="//cdnjs.cloudflare.com/ajax/libs/d3/3.4.6/d3.min.js" data-semver="3.4.6" data-require="d3@*"></script>
    <script src="https://d3js.org/d3.v4.min.js"></script>
</head>


<style>
    /* .fields {
        margin: 4px;
        display: none;
    } */

    .field{
        display: none;
        padding: 8px;
    }


    /* .labels {
        display: none;
    } */


   #fieldrow1{
       display: block;
   }

   #chart {
       display: inline;
   }
</style>



<body>
    <div class="bodybin">
        <form class="input-form" style="padding: 20px; display: inline;">

            Title: <input class="title" id="title" type="float" /><br />
            Subtitle: <input class="subtitle" id="subtitle" type="float" /><br/><br/>

            <b>Input Data:</b><br/>
            <div id="fieldrow1" class="field"><input class="labels" id="l1" type="float" /><input class="fields" id="f1" type="float" /></div>
            <div id="fieldrow2" class="field"><input class="labels" id="l2" type="float" /><input class="fields" id="f2" type="float" /></div>
            <div id="fieldrow3" class="field"><input class="labels" id="l3" type="float" /><input class="fields" id="f3" type="float" /></div>
            <div id="fieldrow4" class="field"><input class="labels" id="l4" type="float" /><input class="fields" id="f4" type="float" /></div>
            <div id="fieldrow5" class="field"><input class="labels" id="l5" type="float" /><input class="fields" id="f5" type="float" /></div>
            <div id="fieldrow6" class="field"><input class="labels" id="l6" type="float" /><input class="fields" id="f6" type="float" /></div>
            <div id="fieldrow7" class="field"><input class="labels" id="l7" type="float" /><input class="fields" id="f7" type="float" /></div>
            <div id="fieldrow8" class="field"><input class="labels" id="l8" type="float" /><input class="fields" id="f8" type="float" /></div>
            <div id="fieldrow9" class="field"><input class="labels" id="l9" type="float" /><input class="fields" id="f9" type="float" /></div>
            <div id="fieldrow10" class="field"><input class="labels" id="l10" type="float" /><input class="fields" id="f10" type="float" /></div>
            <div id="fieldrow11" class="field"><input class="labels" id="l11" type="float" /><input class="fields" id="f11" type="float" /></div>
            <div id="fieldrow12" class="field"><input class="labels" id="l12" type="float" /><input class="fields" id="f12" type="float" /></div>
            <div id="fieldrow13" class="field"><input class="labels" id="l13" type="float" /><input class="fields" id="f13" type="float" /></div>
            <div id="fieldrow14" class="field"><input class="labels" id="l14" type="float" /><input class="fields" id="f14" type="float" /></div>
            <div id="fieldrow15" class="field"><input class="labels" id="l15" type="float" /><input class="fields" id="f15" type="float" /></div>
            <div id="fieldrow16" class="field"><input class="labels" id="l16" type="float" /><input class="fields" id="f16" type="float" /></div>
            <div id="fieldrow17" class="field"><input class="labels" id="l17" type="float" /><input class="fields" id="f17" type="float" /></div>
            <div id="fieldrow18" class="field"><input class="labels" id="l18" type="float" /><input class="fields" id="f18" type="float" /></div>
            <div id="fieldrow19" class="field"><input class="labels" id="l19" type="float" /><input class="fields" id="f19" type="float" /></div>
            <div id="fieldrow20" class="field"><input class="labels" id="l20" type="float" /><input class="fields" id="f20" type="float" /></div>
            <div id="fieldrow21" class="field"><input class="labels" id="l21" type="float" /><input class="fields" id="f21" type="float" /></div>
            <div id="fieldrow22" class="field"><input class="labels" id="l22" type="float" /><input class="fields" id="f22" type="float" /></div>
            <div id="fieldrow23" class="field"><input class="labels" id="l23" type="float" /><input class="fields" id="f23" type="float" /></div>
            <div id="fieldrow24" class="field"><input class="labels" id="l24" type="float" /><input class="fields" id="f24" type="float" /></div>
            <div id="fieldrow25" class="field"><input class="labels" id="l25" type="float" /><input class="fields" id="f25" type="float" /></div>

            <input id="addfield" type="button" value="Add Field">
        </form>

        <input type="submit" id="submit" />
    </div>

    <script type="text/javascript">
        // initialize the field number to be 1.
        var field_num = 2;

        d3.select("#addfield").on("click", function () {
            // create a string of the field id
            let field_row = String("#fieldrow" + field_num)

            // show the corresponding field
            d3.selectAll(field_row).style("display", "block")
            field_num += 1;
            console.log(field_num)
        });

    </script>

    <div>
        <button id='saveButton'>Export to PNG</button>
    </div>
    <div id="chart"></div>
    </div>
    <script type="text/javascript">

        var new1;
        var new2;
        var new3;
        var new4;
        var new5;
        var new6;
        var new7;
        var new9;
        var new10;
        var new11;
        var new12;
        var new13;
        var new14;
        var new15;
        var new16;
        var new17;
        var new18;
        var new19;
        var new20;
        var new21;
        var new22;
        var new23;
        var new24;
        var new25;
        var title;
        var subtitle;

        d3.select("#submit").on("click", function () {
            update();
            return false;
        });



        function update() {
            new1 = document.getElementById("f1").value;
            new2 = document.getElementById("f2").value;
            new3 = document.getElementById("f3").value;
            new4 = document.getElementById("f4").value;
            new5 = document.getElementById("f5").value;
            new6 = document.getElementById("f6").value;
            new7 = document.getElementById("f7").value;
            new8 = document.getElementById("f8").value;
            new9 = document.getElementById("f9").value;
            new10 = document.getElementById("f10").value;
            new11 = document.getElementById("f11").value;
            new12 = document.getElementById("f12").value;
            new13 = document.getElementById("f13").value;
            new14 = document.getElementById("f14").value;
            new15 = document.getElementById("f15").value;
            new16 = document.getElementById("f16").value;
            new17 = document.getElementById("f17").value;
            new18 = document.getElementById("f18").value;
            new19 = document.getElementById("f19").value;
            new20 = document.getElementById("f20").value;
            new21 = document.getElementById("f21").value;
            new22 = document.getElementById("f22").value;
            new23 = document.getElementById("f23").value;
            new24 = document.getElementById("f24").value;
            new25 = document.getElementById("f25").value;


            var value_array = [Number(new1), 
                Number(new2), Number(new3), Number(new4),
                Number(new5),Number(new6),Number(new7),Number(new8),
                Number(new9),Number(new10), Number(new11), Number(new12), 
                Number(new13), Number(new14),
                Number(new15), Number(new16), Number(new17), Number(new18), 
                Number(new19),Number(new20),Number(new21),Number(new22),
                Number(new23),Number(new24),Number(new25)];

            console.log(value_array)

            var array_min = Math.min(...value_array)
            var array_max = Math.max(...value_array)
            console.log(array_min)
            console.log(array_max);

            let index = 0;


            // label values

            l1 = document.getElementById("l1").value;
            l2 = document.getElementById("l2").value;
            l3 = document.getElementById("l3").value;
            l4 = document.getElementById("l4").value;
            l5 = document.getElementById("l5").value;
            l6 = document.getElementById("l6").value;
            l7 = document.getElementById("l7").value;
            l8 = document.getElementById("l8").value;
            l9 = document.getElementById("l9").value;
            l10 = document.getElementById("l10").value;
            l11 = document.getElementById("l11").value;
            l12 = document.getElementById("l12").value;
            l13 = document.getElementById("l13").value;
            l14 = document.getElementById("l14").value;
            l15 = document.getElementById("l15").value;
            l16 = document.getElementById("l16").value;
            l17 = document.getElementById("l17").value;
            l18 = document.getElementById("l18").value;
            l19 = document.getElementById("l19").value;
            l20 = document.getElementById("l20").value;
            l21 = document.getElementById("l21").value;
            l22 = document.getElementById("l22").value;
            l23 = document.getElementById("l23").value;
            l24 = document.getElementById("l24").value;
            l25 = document.getElementById("l25").value;
            title = document.getElementById("title").value;
            subtitle = document.getElementById("subtitle").value;

            var dataset2 = [
                { count: new1, size: new1 * 2.2, label: l1 },
                { count: new2, size: new2 * 2.2, label: l2 },
                { count: new3, size: new3 * 2.2, label: l3 },
                { count: new4, size: new4 * 2.2, label: l4 },
                { count: new5, size: new5 * 2.2, label: l5 },
                { count: new6, size: new6 * 2.2, label: l6 },
                { count: new7, size: new7 * 2.2, label: l7 },
                { count: new8, size: new8 * 2.2, label: l8 },
                { count: new9, size: new9 * 2.2, label: l9 },
                { count: new10, size: new10 * 2.2, label: l10 },
                { count: new11, size: new11 * 2.2, label: l11 },
                { count: new12, size: new12 * 2.2, label: l12 },
                { count: new13, size: new13 * 2.2, label: l13 },
                { count: new14, size: new14 * 2.2, label: l14 },
                { count: new15, size: new15 * 2.2, label: l15 },
                { count: new16, size: new16 * 2.2, label: l16 },
                { count: new17, size: new17 * 2.2, label: l17 },
                { count: new18, size: new18 * 2.2, label: l18 },
                { count: new19, size: new19 * 2.2, label: l19 },
                { count: new20, size: new20 * 2.2, label: l20 },
                { count: new21, size: new21 * 2.2, label: l21 },
                { count: new22, size: new22 * 2.2, label: l22 },
                { count: new23, size: new23 * 2.2, label: l23 },
                { count: new24, size: new24 * 2.2, label: l24 },
                { count: new25, size: new25 * 2.2, label: l25 }
            ];

            console.log(dataset2)


            var width = 760;
            var height = 760;
            var donutWidth = 305;
            var innerRadius = (Math.min(width, height) / 2) - donutWidth;

            var color = d3.scaleOrdinal()
                .range(["#E81A1A", "#EE4914", "#F4790D", "#F7910A", "#F9AB07", "#FCC004", "#FFD700",
                    "#C8C912", "#91BB25", "#59AD37", "#229F49", "#249755", "#268E61", "#29866D", "#2B7D79",
                    "#2F6C91", "#335BA9", "#4551A2", "#57479B", "#693C94", "#7B32BD", "#962C70", "#A42962",
                    "#B22654", "#CD2037"])

            var svg = d3.select('#chart')
                .append('svg')
                .attr('width', width)
                .attr('height', height)
                .append('g')
                .attr('transform', 'translate(' + (width / 2) +
                    ',' + (height / 2) + ')');

            var thetitle = svg.append("text")
                .attr("color", "black")
                .attr("font-size", "22px")
                .attr("x", -25)
                .attr("y", -10)
                .text(title)


            var thesubtitle = svg.append("text")
                .attr("color", "black")
                .attr("font-size", "16px")
                .attr("x", -45)
                .attr("y", 25)
                .text(subtitle)

            var arc = d3.svg.arc()
                .innerRadius(innerRadius)
                .outerRadius(function (d) {
                    return innerRadius + d.data.size;
                });

            var pie = d3.layout.pie()
                .value(function (d) { return d.count; })
                .sort(null);

            var data_ready = pie(dataset2)

            var path = svg.selectAll('path')
                .data(pie(dataset2))
                .enter()
                .append('path')
                .attr('d', arc)
                .attr('fill', function (d, i) {
                    return color(i);
                });


        //     // Another arc that won't be drawn. Just for labels positioning
        //     var outerArc = d3.arc()
        //         .innerRadius(innerRadius*.9)
        //         .outerRadius(innerRadius*.9)

        //     // Add the polylines between chart and labels:
        //     svg
        //         .selectAll('allPolylines')
        //         .data(data_ready)
        //         .enter()
        //         .append('polyline')
        //         .attr("stroke", "black")
        //         .style("fill", "none")
        //         .attr("stroke-width", 1)
        //         .attr('points', function (d) {
        //             var posA = arc.centroid(d) // line insertion in the slice
        //             var posB = outerArc.centroid(d) // line break: we use the other arc generator that has been built only for that
        //             var posC = outerArc.centroid(d); // Label position = almost the same as posB
        //             var midangle = d.startAngle + (d.endAngle - d.startAngle) / 2 // we need the angle to see if the X position will be at the extreme right or extreme left
        //             posC[0] = innerRadius * 0.95 * (midangle < Math.PI ? 1 : -1); // multiply by 1 or -1 to put it on the right or on the left
        //             return [posA, posB, posC]
        //         })

        //     // Add the polylines between chart and labels:
        //     svg
        //         .selectAll('allLabels')
        //         .data(data_ready)
        //         .enter()
        //         .append('text')
        //         .text(function (d) { console.log(d.data.label); return d.data.label })
        //         .attr('transform', function (d) {
        //             var pos = outerArc.centroid(d);
        //             var midangle = d.startAngle + (d.endAngle - d.startAngle) / 2
        //             pos[0] = innerRadius * 0.99 * (midangle < Math.PI ? 1 : -1);
        //             return 'translate(' + pos + ')';
        //         })
        //         .style('text-anchor', function (d) {
        //             var midangle = d.startAngle + (d.endAngle - d.startAngle) / 2
        //             return (midangle < Math.PI ? 'start' : 'end')
        //         })



        //     return false;
        }


    </script>
</body>

</html>